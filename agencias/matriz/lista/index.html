<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="stylesheet" href="/assets/css/bootstrap/bootstrap.css" />
  <link rel="stylesheet" href="/assets/css/custom.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
    integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>RedeTrade</title>
  <meta name="author" content="Lucas Santana" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"
    integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous" />
  <style>
    .required-field-label {
      position: relative;
    }

    .required-field-label::after {
      content: "*";
      color: #FF6600;
      position: absolute;
      top: 0;
      right: -10px;
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <!-- Sidebar  -->
    <side-bar></side-bar>
    <!-- Page Content  -->
    <div id="content">
      <!-- Navbar -->
      <nav-bar></nav-bar>
      <div class="container py-2">
          <div class="container-simple">
            <p class="text-muted font-weight-bold">Agências</p>
        </div>
        <div class="container p-4 bg-white rounded shadow">
          <div class="row">
            <div class="col-md-3 pt-1">
              <label> </label>
              <span class="input-icon"><i class="fas fa-search"></i></span>
              <input
                placeholder="Pesquisar..."
                class="form-control search-input"
                type="search"
                name="s"
                title="Search"
                value=""
              />
            </div>
            <div class="col-md-3 pt-1">
              <label>Agência</label>
              <select class="form-control" id="selectAgencia">
                <option>Selecionar</option>
              </select>
            </div>
            <div class="col-md-3 pt-1">
              <label>Nome Fantasia</label>
              <input type="text" class="form-control" id="inputNomeFantasia" placeholder="Digite o nome fantasia">
            </div>
            <div class="col-md-3 pt-1 lastE">
              <label>N° da Conta</label>
              <input type="text" class="form-control" id="inputNumeroDaConta" placeholder="Digite o N° da Conta">
            </div>
            <div class="row button-container">
              <div class="col-4 offset-8 text-right pt-4 button-container">
                <button type="button" class="btn btn-orange  btn-sm" id="localizarBtn">
                  <i class="fas fa-search"></i>
                  Localizar
                </button>
                <a href="../cadastrar/index.html">
                  <button type="button" class="btn btn-purple  btn-sm" id="btnCadastrar">
                    <i class="fas fa-plus"></i>
                    Cadastrar
                  </button>
                </a>
              </div>
              
            </div>
          </div>
        </div>
      </div>
      <div class="container mt-2 p-4 bg-white rounded shadow">
        <table class="table table-borderless table-hover" id="unidadesTable">
          <thead>
            <tr id="headerRow">
              <th scope="col">Unidade</th>
              <th scope="col">Estado</th>
              <th scope="col">Conta</th>
              <th scope="col">E-mail</th>
              <th scope="col">Status</th>
              <th scope="col">Tipo</th>
              <th scope="col" class="text-center">Operação</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="align-middle" id="unidade"></td>
              <td class="align-middle" id="conta"></td>
              <td class="align-middle" id="email"></td>
              <td class="align-middle" id="status"></td>
            </tr>
          </tbody>
        </table>
        <nav>
          <ul class="pagination justify-content-center">
            <li class="page-item disabled">
              <a class="page-link" href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">Previous</span>
              </a>
            </li>
            <li class="page-item disabled">
              <a class="page-link" href="#" tabindex="-1">1</a>
            </li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item"><a class="page-link" href="#">4</a></li>
            <li class="page-item"><a class="page-link" href="#">5</a></li>
            <li class="page-item"><a class="page-link" href="#">6</a></li>
            <li class="page-item"><a class="page-link" href="#">7</a></li>
            <li class="page-item">
              <a class="page-link" href="#" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Next</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      <footer-bar></footer-bar>

    </div>
  </div>
  <!-- Modal -->
  <div class="modal fade " id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl " role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar Agência</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="cadastroForm" enctype="multipart/form-data">
            <div class="container p-4 bg-white rounded shadow">
              <div class="row">
                <div class="col-md-4 pt-1">
                  <label class="required-field-label">Razão Social</label>
                  <input type="text" class="form-control" id="razaoSocial" name="razaoSocial" required />
                </div>
                <div class="col-md-4 pt-1">
                  <label class="required-field-label">Nome Fantasia</label>
                  <input type="text" class="form-control" id="nomeFantasia" name="nomeFantasia" required />
                </div>
                <div class="col-md-4 pt-1">
                  <label class="required-field-label">CNPJ</label>
                  <input type="text" class="form-control" id="cnpj" name="cnpj" required />
                </div>
                <div class="col-md-3 pt-1">
                  <label>Insc. Estadual</label>
                  <input type="text" class="form-control" id="inscEstadual" name="inscEstadual" />
                </div>
                <div class="col-md-3 pt-1">
                  <label>Insc. Municipal</label>
                  <input type="text" class="form-control" id="inscMunicipal" name="inscMunicipal" />
                </div>
                <div class="col-md-3 pt-1">
                  <label>Mostrar no site</label>
                  <select class="form-control" id="mostrarNoSite" name="mostrarNoSite" required>
                    <option value="1">Sim</option>
                    <option value="0">Não</option>
                  </select>
                </div>
                <div class="col-md-3 pt-1">
                  <label>Tipo</label>
                  <select class="form-control" id="tipo" name="tipo" required>
                    <option>Master</option>
                    <option>Comum</option>
                    <option>Filial</option>
                  </select>
                </div>
              </div>

              <div class="col-12 border-top border-bottom my-4 py-2">
                <p class="h4 m-0">Contato</p>
              </div>

              <div class="row">
                <div class="col-md-4 pt-1">
                  <label class="required-field-label">Nome</label>
                  <input type="text" class="form-control" id="nomeContato" name="nomeContato" required />
                </div>
                <div class="col-md-4 pt-1">
                  <label class="required-field-label">Telefone</label>
                  <input type="text" class="form-control" id="telefone" name="telefone" required />
                </div>
                <div class="col-md-4 pt-1">
                  <label>Celular</label>
                  <input type="text" class="form-control" id="celular" name="celular" />
                </div>
                <div class="w-100"></div>
                <div class="col-md-4 pt-1">
                  <label class="required-field-label">E-mail</label>
                  <input type="text" class="form-control" id="emailContato" name="emailContato" required />
                </div>
                <div class="col-md-4 pt-1">
                  <label>E-mail secundário</label>
                  <input type="text" class="form-control" id="emailSecundario" name="emailSecundario" />
                </div>
              </div>

              <div class="col-12 border-top border-bottom my-4 py-2">
                <p class="h4 m-0">Endereço</p>
              </div>

              <div class="row">
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">Logradouro</label>
                  <input type="text" class="form-control" id="logradouro" name="logradouro" />
                </div>
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">Numero</label>
                  <input type="text" class="form-control" id="numero" name="numero" required />
                </div>
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">CEP</label>
                  <input type="text" class="form-control" id="cep" name="cep" required />
                </div>
                <div class="col-md-3 pt-1">
                  <label>Complemento</label>
                  <input type="text" class="form-control" id="complemento" name="complemento" />
                </div>
                <div class="w-100"></div>
                <div class="col-md-3 pt-1">
                  <label class="required-field-label"></label>Bairro</label>
                  <input type="text" class="form-control" id="bairro" name="bairro" required />
                </div>
                <div class="col-md-4 pt-1">
                  <label class="required-field-label">Cidade</label>
                  <input type="text" class="form-control" id="cidade" name="cidade" required />
                </div>
                <div class="col-md-2 pt-1">
                  <label class="required-field-label">Estado</label>
                  <input type="text" class="form-control" id="estado" name="estado" required />
                </div>
                <div class="col-md-3 pt-1">
                  <label>Região</label>
                  <input type="text" class="form-control" id="regiao" name="regiao" />
                </div>
              </div>

              <div class="col-12 border-top border-bottom my-4 py-2">
                <p class="h4 m-0">Unidade</p>
              </div>

              <div class="row">
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">Plano de Inscrição</label>
                  <select class="form-control" id="planoDeInscricao" name="planoDeInscricao" required>
                    <option value="Franquia">Franquia</option>
                  </select>
                </div>

                <div class="col-md-4 pt-1">
                  <label class="required-field-label">Porcentagem Plano de Inscrição</label>
                  <input type="text" class="form-control" id="porcentagemPlanoDeInscricao"
                    name="porcentagemPlanoDeInscricao" readonly required>
                </div>

                <div class="col-md-5 pt-1">
                  <label class="required-field-label">Nome da Franquia</label>
                  <input type="text" class="form-control" id="nomeFranquia" name="nomeFranquia" required />
                </div>
              </div>

              <div class="col-12 border-top border-bottom my-4 py-2">
                <p class="h4 m-0">Operações</p>
              </div>

              <div class="row">
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">Limite Crédito</label>
                  <input type="number" step=0.01 class="form-control" id="limiteCredito" name="limiteCredito"
                    required />
                </div>
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">Taxa Repasse Matriz em %</label>
                  <input type="number" class="form-control" id="taxaRepasseMatriz" name="taxaRepasseMatriz" required />
                </div>
                <div class="col-md-3 pt-1">
                  <label>Data Vencimento Fatura</label>
                  <select class="form-control" id="dataVencimentoFatura" name="dataVencimentoFatura" required>
                    <option>10</option>
                    <option>20</option>
                    <option>30</option>
                  </select>
                </div>
                <div class="col-md-3 pt-1">
                  <label>Tipo de operação</label>
                  <select class="form-control" id="tipoOperacao" name="tipoOperacao" required>
                    <option>Royalties</option>
                  </select>
                </div>
                <!--<div class="col-md-2 pt-1">
                    <label class="required-field-label">Tipo de operação taxa</label>
                    <select class="form-control" id="tipoOperacaoTaxa" name="tipoOperacaoTaxa" required>
                      <option value="0">ver as taxas</option>
                    </select>
                  </div>-->
              </div>

              <div class="col-12 border-top border-bottom my-4 py-2">
                <p class="h4 m-0">Dados do Usuario</p>
              </div>

              <div class="row">
                <div class="col-md-3 pt-1">
                  <img src="/assets/img/default_img.png" class="rounded float-left img-fluid" alt="..."
                    id="imagem-selecionada" />
                </div>
                <div class="w-100"></div>
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">Selecionar Foto</label>
                  <div class="custom-file mb-3">
                    <input type="file" class="custom-file-input" id="imagem" name="imagem" />
                    <label class="custom-file-label d-hide" for="customFile">Selecionar</label>
                  </div>
                </div>
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">Nome</label>
                  <input type="text" class="form-control" id="nome" name="nome" required />
                </div>
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">Cpf</label>
                  <input type="text" class="form-control" id="cpf" name="cpf" required />
                </div>
                <div class="col-md-3 pt-1">
                  <label class="required-field-label">E-mail</label>
                  <input type="text" class="form-control" id="email" name="email" required />
                </div>
                <div class="w-100"></div>
                <div class="container alert"></div>
              </div>
          </form>
        </div>
        <div class="modal-footer">
          <div class="container showAlertEdit"></div>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
          <button type="submit" class="btn btn-primary" id="salvar-alteracoes-btn">Salvar alterações</button>
          <div class="container alert"></div>
        </div>
      </div>
    </div>
  </div>
  <style>
    .popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .popup-form {
      background-color: #fff;
      padding: 20px;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
  </script>
  <script src="/assets/js/bootstrap.js"></script>
  <script src="/assets/js/main.js"></script>
  <script src="/assets/js/session.js"></script>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <!-- <script src="/__/firebase/7.21.0/firebase-app.js"></script> -->
  <!-- Import Components -->
  <script src="/components/navbar.js"></script>
  <script src="/components/sidebar2.js"></script>
  <script src="/components/footer.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
  <!-- <script src="/__/firebase/7.21.0/firebase-analytics.js"></script> -->
  <!-- Initialize Firebase -->
  <!-- <script src="/__/firebase/init.js"></script> -->
  <script src="/assets/js/config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js"
    integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js"
    integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous">
  </script>
  <!-- Script Mascaras-->
  <script>
    $(document).ready(function () {
      $('#cpf').inputmask('999.999.999-99', {
        placeholder: '___.___.___-__'
      });
      $('#cnpj').inputmask('99.999.999/9999-99', {
        placeholder: '__.___.___/____-__'
      });
    });
  </script>
  <!-- ViaCep-->
  <script>
    function obterRegiaoPorCEP(cep) {
      cep = cep.replace(/\D/g, '');

      const regioes = {
        'Norte': [69000000, 69999999],
        'Nordeste': [40000000, 49999999],
        'Centro-Oeste': [70000000, 78999999],
        'Sudeste': [1000000, 39999999],
        'Sul': [80000000, 99999999]
      };

      for (const regiao in regioes) {
        const intervalo = regioes[regiao];
        const cepNumerico = parseInt(cep);

        if (cepNumerico >= intervalo[0] && cepNumerico <= intervalo[1]) {
          return regiao;
        }
      }

      return null;
    }

    document.getElementById('cep').addEventListener('input', function () {
      var cep = document.getElementById('cep').value;
      if (cep.length === 8) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'https://viacep.com.br/ws/' + cep + '/json/');
        xhr.onload = function () {
          if (xhr.status === 200) {
            var endereco = JSON.parse(xhr.responseText);
            //console.log(endereco);
            document.getElementById('logradouro').value = endereco.logradouro;
            document.getElementById('bairro').value = endereco.bairro;
            document.getElementById('cidade').value = endereco.localidade;
            document.getElementById('estado').value = endereco.uf;

            var regiao = obterRegiaoPorCEP(cep);
            if (regiao) {
              //console.log(`O CEP ${cep} está na região ${regiao}.`);
              document.getElementById('regiao').value = regiao;
            } else {
              //console.log(`Não foi possível determinar a região para o CEP ${cep}.`);
            }
          } else {
            alert('Erro ao consultar CEP. Por favor, tente novamente mais tarde.');
          }
        };
        xhr.send();
      }
    });

    function formatarCep(event) {
      const cepInput = document.getElementById('cep');
      const cepValue = cepInput.value.trim();

      if (cepValue.length === 5 && event.key !== 'Backspace') {
        cepInput.value = cepValue + '-';
      }
    }
  </script>
  <!--Script preencher tabela -->
  <script>
    $(document).ready(function () {
      // Recupera o cookie
      var cookies = document.cookie.split(';');
      for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i].trim();
        if (cookie.indexOf('usuarioId=') === 0) {
          var usuarioId = cookie.substring('usuarioId='.length, cookie.length);
          break;
        }
      }
      // Verifica se o idUsuario foi encontrado
      if (usuarioId === '') {
        console.error('O cookie idUsuario não foi encontrado.');
        return;
      }
      const apiUrl = `${window.apiBaseUrl}/usuarios/${usuarioId}`;
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Erro na resposta do servidor');
          }
          return response.json();
        })
        .then(data => {
          const tableBody = document.querySelector('tbody');

          // Limpa o conteúdo atual da tabela
          tableBody.innerHTML = '';
          var usuarios = data.usuarios;
          // Limpa as opções atuais do <select> Agencia
          $('#selectAgencia').empty();
          // Adiciona uma opção vazia como padrão
          $('#selectAgencia').append('<option value="">Selecionar</option>');
          // Itera sobre os usuários retornados pela API
          usuarios.forEach(function (usuario) {
            // Verifica se o tipo do usuário é Master, Comum ou Matriz
            if (usuario.dadosGerais.tipo == 'Master' || usuario.dadosGerais.tipo === 'Comum' || usuario
              .dadosGerais.tipo === 'Matriz') {
              // Adiciona uma nova opção ao <select> com o nomeFranquia do usuário
              $('#selectAgencia').append('<option value="' + usuario.id + '">' + usuario.dadosAgencias
                .nomeFranquia + '</option>');
            }
          });
          // Manipulador de evento de clique para o botão "Localizar"
          $('#localizarBtn').click(function () {
            var filtroNomeFantasia = $('#inputNomeFantasia').val(); // Obtém o valor do campo de filtro
            var filtroNumeroConta = $('#inputNumeroDaConta').val(); // Obtém o valor do campo de filtro

            var filtroAgencia = $('#selectAgencia option:selected')
              .text(); // Obtém o nome fantasia do elemento selecionado

            // Verifica se o valor do filtro está presente em algum dos dados dos usuários
            var encontrado = false;
            usuarios.forEach(function (usuario) {
              if (usuario.dadosAgencias.nomeFranquia.toLowerCase() == filtroAgencia.toLowerCase() ||
                usuario.dadosGerais.nomeFantasia.toLowerCase() == filtroNomeFantasia.toLowerCase() ||
                usuario.conta == filtroNumeroConta) {
                encontrado = true;
                // Faça algo com os dados do usuário encontrado, se necessário
                //console.log(usuario);
                //console.log(usuario.nomeFantasia);
                const row = document.createElement('tr');

                // Cria as células da linha com os dados da agência
                const idCell = document.createElement('td');
                idCell.textContent = usuario.dadosAgencias.nomeFranquia;
                row.appendChild(idCell);

                const estadoCell = document.createElement('td');
                estadoCell.textContent = usuario.dadosEnderecos.estado;
                row.appendChild(estadoCell);

                const contaCell = document.createElement('td');
                contaCell.textContent = usuario.conta;
                row.appendChild(contaCell);

                const emailCell = document.createElement('td');
                emailCell.textContent = usuario.email;
                row.appendChild(emailCell);

                const statusContaCell = document.createElement('td');
                if (usuario.dadosGerais.status == 0) {
                  statusContaCell.textContent = "Inativa";
                  row.appendChild(statusContaCell);
                } else {
                  statusContaCell.textContent = "Ativa";
                  row.appendChild(statusContaCell);
                }

                const tipoCell = document.createElement('td');
                tipoCell.textContent = usuario.dadosGerais.tipo;
                row.appendChild(tipoCell);

                const operationsCell = document.createElement("td");
                operationsCell.className = "text-center align-middle d-flex justify-content-center";
                operationsCell.style.gap = "0.1rem";

                // Cria os botões para as operações
                const editButton = document.createElement("button");
                editButton.type = "button";
                editButton.className = "btn btn-sm";
                editButton.innerHTML = '<i class="fas fa-pencil-alt"></i>';
                editButton.style.backgroundColor = "#3C0464";
                editButton.style.color = "#fff";
                // Define o atributo data-modal no botão
                editButton.setAttribute("data-modal", "myModal"); // Substitua "myModal" pelo ID correto do seu modal
                operationsCell.appendChild(editButton);
                // Attach an event listener to the edit button
                editButton.addEventListener('click', function () {
                  openPopupEdit(usuario);
                });

                const unlockButton = document.createElement("button");
                if (usuario.statusConta == 0) {
                  unlockButton.type = "button";
                  unlockButton.className = "btn btn-danger btn-sm";
                  unlockButton.innerHTML = '<i class="fas fa-lock"></i>';
                  unlockButton.addEventListener("click", function () {
                    sendData(true);
                  });
                  operationsCell.appendChild(unlockButton);
                } else {
                  unlockButton.type = "button";
                  unlockButton.className = "btn btn-success btn-sm";
                  unlockButton.innerHTML = '<i class="fas fa-unlock"></i>';
                  unlockButton.addEventListener("click", function () {
                    sendData(false);
                  });
                  operationsCell.appendChild(unlockButton);

                }

                function sendData(value) {
                  const data = {
                    statusConta: value
                  };
                  const apiUrl = `${window.apiBaseUrl}/usuarios/status/${usuario.id}`;

                  fetch(apiUrl, {
                      method: "POST",
                      headers: {
                        "Content-Type": "application/json"
                      },
                      body: JSON.stringify(data)
                    })
                    .then(response => {
                      //console.log(response);
                      // Handle the response
                      location.reload();
                    })
                    .catch(error => {
                      // Handle the error
                    });
                }
                row.appendChild(operationsCell);

                // Adiciona a linha à tabela
                tableBody.appendChild(row);
              }
            });

            if (encontrado) {
              showAlert('Usuário encontrado!', 'success');
            } else {
              showAlert('Usuário não encontrado!', 'danger');
            }
          });
        })
        .catch(error => console.error('Erro:', error));
    });

    function showAlert(message, type) {
      var alert = document.createElement("div");
      alert.classList.add("alert", "alert-" + type);
      alert.innerHTML = message;
      var container = document.querySelector(".container");
      container.insertBefore(alert, container.firstChild);
      setTimeout(function () {
        alert.remove();
      }, 3000);
    }
  </script>

  <!-- Função para abrir o popup e preencher os campos -->
  <script>
    function openPopupEdit(usuario) {
      $('#myModal').modal('show');
      preencherCampos(usuario);

      // Adicionar ouvinte de evento ao botão "Salvar Alterações"
      const salvarAlteracoesBtn = document.getElementById('salvar-alteracoes-btn');
      salvarAlteracoesBtn.addEventListener('click', () => {
        enviarDadosFormulario(usuario);
      });
    }
  </script>
  <!-- Função para preencher os campos com dados -->
  <script>
    function preencherCampos(usuario) {
      console.log(usuario);
      const razaoSocial = document.getElementById('razaoSocial');
      const nomeFantasia = document.getElementById('nomeFantasia');
      const cnpj = document.getElementById('cnpj');
      const inscEstadual = document.getElementById('inscEstadual');
      const inscMunicipal = document.getElementById('inscMunicipal');
      const mostrarNoSiteSelect = document.getElementById('mostrarNoSite');
      const tipo = document.getElementById('tipo');
      const contatoNome = document.getElementById('nomeContato');
      const contatoTelefone = document.getElementById('telefone');
      const contatoCelular = document.getElementById('celular');
      const contatoEmail = document.getElementById('emailContato');
      const contatoEmailSecundario = document.getElementById('emailSecundario');
      const enderecoLargadouro = document.getElementById('logradouro');
      const enderecoNumero = document.getElementById('numero');
      const enderecoCEP = document.getElementById('cep');
      const enderecoComplemento = document.getElementById('complemento');
      const enderecoBairro = document.getElementById('bairro');
      const enderecoCidade = document.getElementById('cidade');
      const enderecoEstado = document.getElementById('estado');
      const enderecoRegiao = document.getElementById('regiao');
      const dataCadastro = document.getElementById('dataCadastro');

      const nomeFranquia = document.getElementById('nomeFranquia');
      const planoInscricao = document.getElementById('planoDeInscricao');
      const porcentagemPlanoInscricao = document.getElementById('porcentagemPlanoDeInscricao');

      const limiteCredito = document.getElementById('limiteCredito');
      const taxaRepasseMatriz = document.getElementById('taxaRepasseMatriz');
      const dataVencimentoFatura = document.getElementById('dataVencimentoFatura');
      const tipoOperacaoTaxa = document.getElementById('tipoOperacaoTaxa');
      const usuarioNome = document.getElementById('nome');
      const usuarioCPF = document.getElementById('cpf');
      const usuarioEmail = document.getElementById('email');
      const imagem = document.getElementById('imagem-selecionada');
      // Preenchendo os campos com os dados correspondentes
      razaoSocial.value = usuario.dadosGerais.razaoSocial;
      nomeFantasia.value = usuario.dadosGerais.nomeFantasia;
      cnpj.value = usuario.dadosGerais.cnpj;
      inscEstadual.value = usuario.dadosGerais.inscEstadual;
      inscMunicipal.value = usuario.dadosGerais.inscMunicipal;
      if (usuario.dadosGerais.mostrarNoSite === true) {
        mostrarNoSiteSelect.selectedIndex = 0; // atribuindo um índice qualquer
      } else {
        mostrarNoSiteSelect.selectedIndex = 1; // atribuindo um índice qualquer
      }

      if (usuario.dadosGerais.tipo === "Master") {
        tipo.selectedIndex = 0;
      } else if (usuario.dadosGerais.tipo === "Comum") {
        tipo.selectedIndex = 1;
      } else {
        tipo.selectedIndex = 2;
      }
      contatoNome.value = usuario.dadosContatos.nomeContato;
      contatoTelefone.value = usuario.dadosContatos.telefone;
      contatoCelular.value = usuario.dadosContatos.celular;
      contatoEmail.value = usuario.dadosContatos.emailContato;

      contatoEmailSecundario.value = usuario.dadosContatos.emailSecundario;
      enderecoLargadouro.value = usuario.dadosEnderecos.logradouro;
      enderecoNumero.value = usuario.dadosEnderecos.numero;
      enderecoCEP.value = usuario.dadosEnderecos.cep;
      enderecoComplemento.value = usuario.dadosEnderecos.complemento;
      enderecoBairro.value = usuario.dadosEnderecos.bairro;
      enderecoCidade.value = usuario.dadosEnderecos.cidade;
      enderecoEstado.value = usuario.dadosEnderecos.estado;
      enderecoRegiao.value = usuario.dadosEnderecos.regiao;

      nomeFranquia.value = usuario.dadosAgencias.nomeFranquia;
      if (usuario.dadosAgencias.planoDeInscricao === "Franquia") {
        planoInscricao.selectedIndex = 0;
      }
      porcentagemPlanoInscricao.value = usuario.dadosAgencias.porcentagemPlanoDeInscricao;
      limiteCredito.value = usuario.dadosOperacoes.limiteCredito;
      taxaRepasseMatriz.value = usuario.dadosOperacoes.taxaRepasseMatriz;
      dataVencimentoFatura.value = usuario.dadosOperacoes.dataVencimentoFatura;
      //tipoOperacaoTaxa.value = usuario.dadosOperacoes.tipoOperacaoTaxa;
      usuarioNome.value = usuario.nome;
      usuarioCPF.value = usuario.cpf;
      usuarioEmail.value = usuario.email;

      const imagemUrl = usuario.imagem ? `${window.apiBaseUrl}/${usuario.imagem.replace(/\\/g, '/')}` :
        '/assets/img/default_img.png';
      imagem.src = imagemUrl;
    }
  </script>
  <!-- Função para enviar os dados do formulário para a API -->
  <script>
    async function enviarDadosFormulario(usuario) {
      const id = usuario.id; // Obter o ID da agência dinamicamente

      const form = document.getElementById('cadastroForm');
      const formData = new FormData(form);
      const imgInput = document.getElementById('imagem');
      const img_path = imgInput.files[0];

      if (!img_path) {
        formData.append('imagem', usuario.imagem);
        //console.log('minha imagem é', usuario.imagem)
      }

      const apiUrl = `${window.apiBaseUrl}/usuarios/${id}`;
      // Mostra os valores de todos os campos do FormData
      for (const [key, value] of formData.entries()) {
          console.log(key, value);
        }
      try {
        const response = await fetch(apiUrl, {
          method: 'PUT',
          headers: {
            // Seus cabeçalhos aqui
          },
          body: formData
        });
        
        const result = await response.json();
        console.log(result);

        //console.log('Resposta do servidor:', result);
        showAlertEdit("Atualização efetuada com sucesso!", "success");
            setTimeout(() => {
              //$('#myModal').modal('hide');
              location.reload();
          }, 4000);

            // Realizar ações adicionais após o sucesso da requisição...
      } catch (error) {
        console.error('Erro ao enviar requisição:', error);
        // Lidar com o erro...
      }
    }
  </script>
  <!-- Carregar Imagem -->
  <script>
    // Adiciona um evento de escuta ao input file
    document.getElementById('imagem').addEventListener('change', function (event) {
      // Obtém o elemento da imagem selecionada
      var imgElement = document.getElementById('imagem-selecionada');

      // Verifica se o usuário selecionou um arquivo
      if (event.target.files.length > 0) {
        // Obtém o arquivo selecionado pelo usuário
        var file = event.target.files[0];

        // Cria um URL temporário para a imagem selecionada
        var imageURL = URL.createObjectURL(file);

        // Define o URL temporário como o atributo src da tag img
        imgElement.src = imageURL;
      } else {
        // Caso o usuário não tenha selecionado um arquivo, exibe a imagem padrão
        imgElement.src = "/assets/img/default_img.png";
      }
    });
  </script>
  <!-- ShowAlert edição -->
  <script>
    function showAlertEdit(message, type) {
      var alert = document.createElement("div");
      alert.classList.add("alert", "alert-" + type);
      alert.innerHTML = message;
      var container = document.querySelector(".showAlertEdit");
      container.insertBefore(alert, container.firstChild);
      setTimeout(function () {
        alert.remove();
      }, 3000);
    }
  </script>
</body>

</html>