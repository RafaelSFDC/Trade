<!DOCTYPE html>
<html lang="pt-br">

<head>
	<meta charset="UTF-8" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<link rel="stylesheet" href="../../../../assets/css/bootstrap/bootstrap.css" />
	<link rel="stylesheet" href="../../../../assets/css/custom.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
		integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<title>RedeTrade</title>
	<meta name="author" content="Lucas Santana" />
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"
		integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous" />
	<style>
		.required-field-label {
			position: relative;
		}

		.required-field-label::after {
			content: "*";
			color: #FF6600;
			position: absolute;
			top: 0;
			right: -10px;
		}
	</style>
</head>

<div class="wrapper">
	<!-- Sidebar  -->
	<side-bar></side-bar>
	<!-- Page Content  -->
	<div id="content">
		<!-- Navbar -->
		<nav-bar></nav-bar>
		<div class="container py-2">
			<div class="container-simple">
				<p class="text-muted font-weight-bold">Novo associado</p>
			</div>

			<div class="container p-4 bg-white rounded shadow">
				<form id="cadastroForm" enctype="multipart/form-data">
					<div class="row">
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Razão Social</label>
							<input type="text" class="form-control" id="razaoSocial" name="razaoSocial" required />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Nome Fantasia</label>
							<input type="text" class="form-control" id="nomeFantasia" name="nomeFantasia" required />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Descrição</label>
							<input type="text" class="form-control" id="descricao" name="descricao" required />
						</div>
						<div class="col-md-3 pt-1">
							<label>Status</label>
							<select class="form-control" id="status" name="status">
								<option value="">Selecionar</option>
								<option value="1">Atendendo</option>
								<option value="0">Não Atendendo</option>
							</select>
						</div>
						<div class="w-100"></div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">CNPJ</label>
							<input type="text" class="form-control" id="cnpj" name="cnpj" required />
						</div>
						<div class="col-md-3 pt-1">
							<label>Insc. Estadual</label>
							<input type="text" class="form-control" id="inscEstadual" name="inscEstadual" />
						</div>
						<div class="col-md-3 pt-1">
							<label>Insc. Municipal</label>
							<input type="text" class="form-control" id="inscMunicipal" name="inscMunicipal" />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Restrições</label>
							<input type="text" class="form-control" id="restricoes" name="restricao" required />
						</div>
						<div class="w-100"></div>
						<div class="col-md-3 pt-1">
							<label>Categoria</label>
							<select class="form-control" id="categoria" name="categoria">
								<option value="">Selecionar</option>
							</select>
						</div>
						<div class="col-md-3 pt-1">
							<label>Subcategoria</label>
							<select class="form-control" id="subCategoria" name="subCategoria">
								<option value="">Selecionar</option>
							</select>
						</div>
						<div class="col-md-3 pt-1">
							<label>Mostrar no site</label>
							<select class="form-control" id="mostrarNoSite" name="mostrarNoSite">
								<option value="">Selecionar</option>
								<option value="1">Sim</option>
								<option value="0">Não</option>
							</select>
						</div>
						<div class="col-md-3 pt-1">
							<label>Tipo</label>
							<select class="form-control" id="tipoDeMoeda">
								<option value="">Selecionar</option>
								<option value="Produto">Produto</option>
								<option value="Servico">Serviço</option>
							</select>
						</div>
						<div class="col-md-3 pt-1">
							<input type="hidden" value="Associado" class="form-control" id="tipo" name="tipo"></input>
						</div>
					</div>

					<div class="col-12 border-top border-bottom my-4 py-2">
						<p class="h4 m-0">Contato</p>
					</div>

					<div class="row">
						<div class="col-md-4 pt-1">
							<label class="required-field-label">Nome</label>
							<input type="text" class="form-control" id="nomeContato" name="nomeContato" required />
						</div>
						<div class="col-md-4 pt-1">
							<label >Telefone</label>
							<input type="text" class="form-control" id="telefone" name="telefone" />
						</div>
						<div class="col-md-4 pt-1">
							<label class="required-field-label">Celular</label>
							<input type="text" class="form-control" id="celular" name="celular" required />
						</div>
						<div class="w-100"></div>
						<div class="col-md-4 pt-1">
							<label class="required-field-label">E-mail</label>
							<input type="text" class="form-control" id="emailContato" name="emailContato" required />
						</div>
						<div class="col-md-4 pt-1">
							<label>E-mail secundário</label>
							<input type="text" class="form-control" id="emailSecundario" name="emailSecundario"/>
						</div>
						<div class="col-md-4 pt-1">
							<label>Site</label>
							<input type="text" class="form-control" id="site" name="site"/>
						</div>
					</div>

					<div class="col-12 border-top border-bottom my-4 py-2">
						<p class="h4 m-0">Endereço</p>
					</div>

					<div class="row">
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Logradouro</label>
							<input type="text" class="form-control" id="logradouro" name="logradouro" required />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Numero</label>
							<input type="text" class="form-control" id="numero" name="numero" required />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">CEP</label>
							<input type="text" class="form-control" id="cep" name="cep" required />
						</div>
						<div class="col-md-3 pt-1">
							<label>Complemento</label>
							<input type="text" class="form-control" id="complemento" name="complemento" />
						</div>
						<div class="w-100"></div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Bairro</label>
							<input type="text" class="form-control" id="bairro" name="bairro" required />
						</div>
						<div class="col-md-4 pt-1">
							<label class="required-field-label">Cidade</label>
							<input type="text" class="form-control" id="cidade" name="cidade" required />
						</div>
						<div class="col-md-2 pt-1">
							<label class="required-field-label">Estado</label>
							<input type="text" class="form-control" id="estado" name="estado" required />
						</div>
						<div class="col-md-3 pt-1">
							<label>Região</label>
							<input type="text" class="form-control" id="regiao" name="regiao" />
						</div>
					</div>

					<div class="col-12 border-top border-bottom my-4 py-2">
						<p class="h4 m-0">Agência</p>
					</div>

					<div class="row d-flex align-items-center">
						<div class="col-md-4 pt-1">
							<label class="required-field-label">Plano de Inscrição</label>
							<select class="form-control" id="planoDeInscricao" name="planoDeInscricao" required>
								<option value="">Selecionar</option>
							</select>
						</div>
						<div class="col-md-4 pt-1">
							<label class="required-field-label">Porcentagem Plano de Inscrição %</label>
							<input type="text" class="form-control" id="porcentagemPlanoDeInscricao"
							 readonly required>
						</div>
						<div class="col-md-4 pt-1">
							<label>Data Vencimento Fatura</label>
							<select class="form-control" id="dataVencimentoFatura" name="dataVencimentoFatura">
								<option value="">Selecionar</option>
								<option>10</option>
								<option>20</option>
								<option>30</option>
							</select>
						</div>
					</div>

					<div class="col-12 border-top border-bottom my-4 py-2">
						<p class="h4 m-0">Operações</p>
					</div>

					<div class="row">
						<div class="col-md-3 pt-1">
							<label>Gerente de Conta</label>
							<select class="form-control" id="gerenteConta" name="gerenteConta">
								<option value="">Selecionar</option>
								<option value="null">Sem Gerente</option>
							</select>
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Taxa Gerente Conta em %</label>
							<input type="text" class="form-control" id="taxaGerenteConta" name="taxaGerenteConta"
								required />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Tipo de Operação</label>
							<select class="form-control" id="tipoOperacao" name="tipoOperacao">
								<option value="">Selecionar</option>
								<option>Royalties</option>
								<option>Taxa de Negócios</option>
							</select>
						</div>
						<div class="col-md-2 pt-1">
							<label class="required-field-label">Limite Crédito</label>
							<input class="form-control" id="limiteCredito" name="limiteCredito" required />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Limite de Venda Mensal</label>
							<input type="text" class="form-control" id="limiteVendaMensal" name="limiteVendaMensal"
								required />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Limite de Venda Total</label>
							<input type="text" class="form-control" id="limiteVendaTotal" name="limiteVendaTotal"
								required />
						</div>
						<div class="col-md-2 pt-1">
							<label>Aceita Orçamento</label>
							<select class="form-control" id="aceitaOrcamento" name="aceitaOrcamento">
								<option value="">Selecionar</option>
								<option value="1">Sim</option>
								<option value="0">Não</option>
							</select>
						</div>
						<div class="col-md-2 pt-1">
							<label>Aceita Voucher</label>
							<select class="form-control" id="aceitaVoucher" name="aceitaVoucher">
								<option value="">Selecionar</option>
								<option value="1">Sim</option>
								<option value="0">Não</option>
							</select>
						</div>
						<div class="w-100"></div>
					</div>
					<div class="col-12 border-top border-bottom my-4 py-2">
						<p class="h4 m-0">Dados do Usuario</p>
					</div>
					<div class="row">
						<div class="col-md-3 pt-1">
							<img src="/assets/img/default_img.png" class="rounded float-left img-fluid" alt="..."
								id="imagem-selecionada" name="imagem-selecionada" />
						</div>
						<div class="w-100"></div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Selecionar Foto</label>
							<div class="custom-file mb-3">
								<input type="file" class="custom-file-input" id="imagem" name="imagem" />
								<label class="custom-file-label d-hide" for="customFile">Selecionar</label>
							</div>
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Nome</label>
							<input type="text" class="form-control" id="nome" name="nome" required />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">Cpf</label>
							<input type="text" class="form-control" id="cpf" name="cpf" required />
						</div>
						<div class="col-md-3 pt-1">
							<label class="required-field-label">E-mail</label>
							<input type="text" class="form-control" id="email" name="email" required />
						</div>
						<div class="w-100"></div>
						<div class="col-4 offset-8 text-right pt-4">
							<button type="submit" class="btn btn-orange w-50 btn-sm" id="botao-salvar">
								Salvar
							</button>
						</div>
						<div class="container alert"></div>
					</div>
				</form>
			</div>
		</div>
		<footer-bar></footer-bar>
	</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
	integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
</script>
<script src="/assets/js/bootstrap.js"></script>
<script src="/assets/js/main.js"></script>
<script src="/assets/js/session.js"></script>

<!-- The core Firebase JS SDK is always required and must be listed first -->
<!-- <script src="/__/firebase/7.21.0/firebase-app.js"></script> -->

<!-- Import Components -->
<script src="/components/navbar.js"></script>
<script src="/components/sidebar2.js"></script>
<script src="/components/footer.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<!-- <script src="/__/firebase/7.21.0/firebase-analytics.js"></script> -->

<!-- Initialize Firebase -->
<!-- <script src="/__/firebase/init.js"></script> -->
<script src="/assets/js/config.js"></script>

<!-- Enviando os dados para a rota  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>

<!-- ViaCep-->
<script>
	function obterRegiaoPorCEP(cep) {
		cep = cep.replace(/\D/g, '');

		const regioes = {
			'Norte': [69000000, 69999999],
			'Nordeste': [40000000, 49999999],
			'Centro-Oeste': [70000000, 78999999],
			'Sudeste': [1000000, 39999999],
			'Sul': [80000000, 99999999]
		};

		for (const regiao in regioes) {
			const intervalo = regioes[regiao];
			const cepNumerico = parseInt(cep);

			if (cepNumerico >= intervalo[0] && cepNumerico <= intervalo[1]) {
				return regiao;
			}
		}

		return null;
	}

	document.getElementById('cep').addEventListener('input', function () {
		var cep = document.getElementById('cep').value;
		if (cep.length === 8) {
			var xhr = new XMLHttpRequest();
			xhr.open('GET', 'https://viacep.com.br/ws/' + cep + '/json/');
			xhr.onload = function () {
				if (xhr.status === 200) {
					var endereco = JSON.parse(xhr.responseText);
					//console.log(endereco);
					document.getElementById('logradouro').value = endereco.logradouro;
					document.getElementById('bairro').value = endereco.bairro;
					document.getElementById('cidade').value = endereco.localidade;
					document.getElementById('estado').value = endereco.uf;

					var regiao = obterRegiaoPorCEP(cep);
					if (regiao) {
						//console.log(`O CEP ${cep} está na região ${regiao}.`);
						document.getElementById('regiao').value = regiao;
					} else {
						//console.log(`Não foi possível determinar a região para o CEP ${cep}.`);
					}
				} else {
					alert('Erro ao consultar CEP. Por favor, tente novamente mais tarde.');
				}
			};
			xhr.send();
		}
	});

	function formatarCep(event) {
		const cepInput = document.getElementById('cep');
		const cepValue = cepInput.value.trim();

		if (cepValue.length === 5 && event.key !== 'Backspace') {
			cepInput.value = cepValue + '-';
		}
	}
</script>
<!-- Script Cadastrar-->
<script>
    // Adicione um evento de "submit" ao formulário para enviar os dados
    const form = document.getElementById('cadastroForm');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      // Perform validation
      function isEmpty(value) {
        return value === undefined || value === null || value === '';
      }

      function areFieldsEmpty(field1, field2) {
        return isEmpty(field1) || isEmpty(field2);
      }
      const apiUrl = `${window.apiBaseUrl}/usuarios/associado`;
      // Obtén el valor del cookie
      var cookies = document.cookie.split(';');
      var usuarioId = null;

      for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i].trim();
        if (cookie.indexOf('usuarioId=') === 0) {
          usuarioId = cookie.substring('usuarioId='.length, cookie.length);
          break;
        }
      }
      const email = document.getElementById('email');
      const nomeFantasia = document.getElementById('nomeFantasia');
      if (areFieldsEmpty(email, nomeFantasia)) {
        showAlert("Por favor, preencha todos os campos obrigatorios. nome Fantasia e Email", "danger");
        return; // Stop form submission
      }
      //const form = document.getElementById('cadastroForm');
      const porcentagemPlanoDeInscricao = document.getElementById('porcentagemPlanoDeInscricao').value;
	  var porcentagemPlanoDeInscricaoSemPercentual = parseInt(porcentagemPlanoDeInscricao, 10);
      console.log('porcentagemPlanoDeInscricaoSemPercentual:', porcentagemPlanoDeInscricaoSemPercentual);
      
	  const formData = new FormData(form);
	  formData.append('porcentagemPlanoDeInscricao', porcentagemPlanoDeInscricaoSemPercentual);
      formData.append('idUsuario', usuarioId);
      formData.append('statusConta', 1);
	  
      // Mostra os valores de todos os campos do FormData
      for (const [key, value] of formData.entries()) {
        console.log(key, value);
      }
      try {
      const response = await fetch(apiUrl, {
        method: 'POST',
        body: formData,
      });

      if (!response.ok) {
        const errorData = await response.json();
        // Handle specific error messages
        if (errorData.error === 'NomeFantasia já existe') {
          showAlert("NomeFantasia já existe", "danger");
        } else if (errorData.error === 'Email já existe') {
          showAlert("Email já existe", "danger");
        } else {
          showAlert(errorData.error, "danger");
        }
        return;
      }
      // Request successful
	  showAlert("Cadastro efetuado com Sucesso", "info");
	  setTimeout(() => {
            location.reload();
          }, 5000);
      // ... (show success message, reload page, etc.)
    } catch (error) {
      console.error('Erro ao enviar requisição:', error);
      // Realizar tratamento de erro, se necessário...
    }
    });
  </script>
<!-- Script Mascaras-->
<script>
	$(document).ready(function () {
		$('#cpf').inputmask('999.999.999-99', {
			placeholder: '___.___.___-__'
		});
		$('#cnpj').inputmask('99.999.999/9999-99', {
			placeholder: '__.___.___/____-__'
		});
	});
</script>
<!-- Carregar Imagem -->
<script>
	// Adiciona um evento de escuta ao input file
	document.getElementById('imagem').addEventListener('change', function (event) {
		// Obtém o elemento da imagem selecionada
		var imgElement = document.getElementById('imagem-selecionada');

		// Verifica se o usuário selecionou um arquivo
		if (event.target.files.length > 0) {
			// Obtém o arquivo selecionado pelo usuário
			var file = event.target.files[0];

			// Cria um URL temporário para a imagem selecionada
			var imageURL = URL.createObjectURL(file);

			// Define o URL temporário como o atributo src da tag img
			imgElement.src = imageURL;
		} else {
			// Caso o usuário não tenha selecionado um arquivo, exibe a imagem padrão
			imgElement.src = "/assets/img/default_img.png";
		}
	});
</script>
<!-- Script para carregar categorias -->
<script>
	document.addEventListener('DOMContentLoaded', function () {
		// Monta a URL da requisição GET com o parâmetro idAgencia incluindo o usuarioId
		const apiUrl = `${window.apiBaseUrl}/categorias`;

		fetch(apiUrl)
			.then(response => response.json())
			.then(data => {
				// Processa os dados JSON recebidos

				data.forEach(categoria => {
					// Cria uma linha na tabela para cada transação
					//console.log('Categoria', categoria);
					// Obtém a referência para o elemento <select>
					const categoriaSelect = document.getElementById('categoria');
					// Cria um elemento de opção
					const optionCategoria = document.createElement('option');
					// Define o texto da opção como o nome do plano
					optionCategoria.textContent = categoria.nome;
					// Define o valor da opção como o ID do plano
					optionCategoria.value = categoria.nome;
					// Adiciona a opção ao elemento <select>
					categoriaSelect.appendChild(optionCategoria);
				});
			})
			.catch(error => console.error('Erro:', error));
	})
</script>
<!-- Script para carregar sub categorias -->
<script>
	document.addEventListener('DOMContentLoaded', function () {
		// Monta a URL da requisição GET com o parâmetro idAgencia incluindo o usuarioId
		const apiUrl = `${window.apiBaseUrl}/subCategorias`;
		fetch(apiUrl)
			.then(response => response.json())
			.then(data => {
				// Processa os dados JSON recebidos

				data.forEach(subCategoria => {
					// Cria uma linha na tabela para cada transação
					//console.log('subCategoria', subCategoria);
					// Obtém a referência para o elemento <select>
					const subCategoriaSelect = document.getElementById('subCategoria');
					// Cria um elemento de opção
					const optionsubCategoria = document.createElement('option');
					// Define o texto da opção como o nome do plano
					optionsubCategoria.textContent = subCategoria.nome;
					// Define o valor da opção como o ID do plano
					optionsubCategoria.value = subCategoria.nome;
					// Adiciona a opção ao elemento <select>
					subCategoriaSelect.appendChild(optionsubCategoria);
				});
			})
			.catch(error => console.error('Erro:', error));
	})
</script>
<!-- Script para carregar gerentes -->
<!--<script>
	document.addEventListener('DOMContentLoaded', function () {
		// Monta a URL da requisição GET com o parâmetro idAgencia incluindo o usuarioId
		const apiUrl = `${window.apiBaseUrl}/gerentes/listar`;
		fetch(apiUrl)
			.then(response => response.json())
			.then(data => {
				console.log(data.message);


				// Processa os dados JSON recebidos

				data.forEach(gerente => {
					// Cria uma linha na tabela para cada transação
					//console.log('gerente', gerente);
					// Obtém a referência para o elemento <select>
					const gerenteContaSelect = document.getElementById('gerenteConta');
					// Cria um elemento de opção
					const optiongerenteConta = document.createElement('option');
					// Define o texto da opção como o nome do plano
					optiongerenteConta.textContent = gerente.nomeFantasia;
					// Define o valor da opção como o ID do plano
					optiongerenteConta.value = gerente.nomeFantasia;
					// Adiciona a opção ao elemento <select>
					gerenteContaSelect.appendChild(optiongerenteConta);
				});
			})
			.catch(error => console.error('Erro:', error));
	})
</script>-->
<!-- Script para carregar planos -->
<script>
	document.addEventListener('DOMContentLoaded', function () {
		// Monta a URL da requisição GET com o parâmetro idAgencia incluindo o usuarioId
		const apiUrl = `${window.apiBaseUrl}/planos/tipo`;
		const tipo = "Associado";
		// Monta o objeto de dados a ser enviado na requisição
		const data = {
			tipo
		};
		const options = {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(data)
		};
		fetch(apiUrl, options)
			.then(response => response.json())
			.then(planos => {
				// Processar os dados recebidos da API
				planos.forEach((plano, index) => {
					//console.log(plano);
					// Obtém a referência para o elemento <select>
					const planoInscricao = document.getElementById('planoDeInscricao');
					// Cria um elemento de opção
					const option = document.createElement('option');
					// Define o texto da opção como o nome do plano
					option.textContent = plano.nome;
					// Define o valor da opção como o ID do plano
					option.value = plano.porcentagem;
					// Adiciona a opção ao elemento <select>
					planoInscricao.appendChild(option);

					// Verifica se é o primeiro resultado e define como selecionado por padrão
					/*if (index === 0) {
						option.selected = true;
						const valorSelecionado = document.getElementById(
						'porcentagemPlanoDeInscricao');
						valorSelecionado.value = option.value;
					}*/
				});
				const valorSelecionado = document.getElementById('porcentagemPlanoDeInscricao');
				const planoInscricao = document.getElementById('planoDeInscricao');

				planoInscricao.addEventListener('change', () => {
					const selectedValue = planoInscricao.value;
					valorSelecionado.value = selectedValue + " %";
				});
			})
			.catch(error => console.error('Erro:', error));
	})
</script>
<!-- Show Alert -->
<script>
    function showAlert(message, type) {
      var alert = document.createElement("div");
      alert.classList.add("alert", "alert-" + type);
      alert.innerHTML = message;

      var container = document.querySelector(".alert");
      container.insertBefore(alert, container.firstChild);

      setTimeout(function () {
        alert.remove();
      }, 3000);
    }
</script>
</body>

</html>