<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="stylesheet" href="/assets/css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" href="/assets/css/custom.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
      integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>RedeTrade</title>
    <meta name="author" content="Lucas Santana" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"
      integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div class="wrapper">
      <!-- Sidebar  -->
      <side-bar></side-bar>

      <!-- Page Content  -->
      <div id="content">
        <!-- Navbar -->
        <nav-bar></nav-bar>
        <div class="container py-2">
          <div class="container-simple">
            <p class="text-muted font-weight-bold">Ofertas</p>
          </div>
          <div class="container p-4 bg-white rounded shadow">
            <div class="row row-cols-5">
              <div class="col pt-1">
                <label>Agência</label>
                <select class="form-control" id="selectAgencia">
                  <option>Selecionar</option>
                </select>
              </div>
              <div class="col pt-1">
                <label>Título</label>
                <input
                  type="text"
                  class="form-control"
                  id="inputTitulo"
                  placeholder="Digite aqui"
                />
              </div>
              <div class="col pt-1">
                <label>Cidade</label>
                <input
                  type="text"
                  class="form-control"
                  id="inputCidade"
                  placeholder="Digite aqui"
                />
              </div>
              <div class="col pt-1">
                <label>Categoria</label>
                <select class="form-control" id="selectCategoria">
                  <option>Selecionar</option>
                </select>
              </div>
              <div class="col pt-1">
                <label>Tipo</label>
                <select class="form-control" id="selectTipo">
                  <option>Selecionar</option>
                  <option value="Produto">Produto</option>
                  <option value="Serviço">Serviço</option>
                </select>
              </div>
              <div class="col-4 offset-8 text-right pt-4">
                <button
                  type="button"
                  class="btn btn-orange w-50 btn-sm"
                  id="btnLocalizar"
                >
                  <i class="fas fa-search"></i>
                  Localizar
                </button>
              </div>
            </div>
          </div>

          <div class="container cards mt-2" style="padding: 15px">
            <div
              class="row"
              style="align-items: center; justify-content: space-between"
            ></div>
          </div>
        </div>
        <footer-bar></footer-bar>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.js"
      integrity="sha256-DrT5NfxfbHvMHux31Lkhxg42LY6of8TaYyK50jnxRnM="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script src="/assets/js/bootstrap.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/session.js"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <!-- <script src="/__/firebase/7.21.0/firebase-app.js"></script> -->

    <!-- Import Components -->
    <script src="/components/navbar.js"></script>
    <script src="/components/sidebar2.js"></script>
    <script src="/components/footer.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <!-- <script src="/__/firebase/7.21.0/firebase-analytics.js"></script> -->

    <!-- Initialize Firebase -->
    <!-- <script src="/__/firebase/init.js"></script> -->
    <script src="/assets/js/config.js"></script>
    <!-- Script para carregar categorias -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Monta a URL da requisição GET com o parâmetro idAgencia incluindo o usuarioId
        const apiUrl = `${window.apiBaseUrl}/categorias`;

        fetch(apiUrl)
          .then((response) => response.json())
          .then((data) => {
            // Processa os dados JSON recebidos

            data.forEach((categoria) => {
              // Cria uma linha na tabela para cada transação
              //console.log('Categoria', categoria);
              // Obtém a referência para o elemento <select>
              const categoriaSelect =
                document.getElementById("selectCategoria");
              // Cria um elemento de opção
              const optionCategoria = document.createElement("option");
              // Define o texto da opção como o nome do plano
              optionCategoria.textContent = categoria.nome;
              // Define o valor da opção como o ID do plano
              optionCategoria.value = categoria.nome;
              // Adiciona a opção ao elemento <select>
              categoriaSelect.appendChild(optionCategoria);
            });
          })
          .catch((error) => console.error("Erro:", error));
      });
    </script>

    <!-- Script para carregar Agencias -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Monta a URL da requisição GET com o parâmetro idAgencia incluindo o usuarioId
        const apiUrl = `${window.apiBaseUrl}/usuarios/tipo`;
        const tiposParaFiltrar = ["Master", "Comum", "Matriz", "Filial"];
        fetch(apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ tipos: tiposParaFiltrar }),
        })
          .then((response) => response.json())
          .then((data) => {
            // Processa os dados JSON recebidos
            //console.log(data);
            data.usuarios.forEach((agencia) => {
              // Obtém a referência para o elemento <select>
              const agenciaSelect = document.getElementById("selectAgencia");
              // Cria um elemento de opção
              const optionAgencia = document.createElement("option");
              // Define o texto da opção como o nome do plano
              optionAgencia.textContent = agencia.dadosAgencias.nomeFranquia;
              // Define o valor da opção como o ID do plano
              optionAgencia.value = agencia.id;
              // Adiciona a opção ao elemento <select>
              agenciaSelect.appendChild(optionAgencia);
            });
          })
          .catch((error) => console.error("Erro:", error));
      });
    </script>

    <!-- Função para adicionar um único card ao container -->
    <script>
      function adicionarCard(oferta) {
        if (!oferta) {
          console.log("sem ofertas");
        }
        let valor = oferta.valor;
        let valorFormatado = valor + " RT";
        // Substituir as barras invertidas "\" por barras normais "/"
        console.log(oferta);

        const imagemUrl = `${window.apiBaseUrl}/${oferta.imagem.replace(
          /\\/g,
          "/"
        )}`;
        const container = document.querySelector(".cards .row");
        // Criação do novo componente
        const newComponent = document.createElement("div");
        newComponent.innerHTML = `
        <div class="container p-0 d-flex flex-column justify-content-center align-items-center" style="width: 352px;height: auto;border: 1px solid #dddddd;background-color:#fff;margin-top:20px;!important">
        <div class="row  m-0 p-0" style="width:100%;">
          <div class="col p-0 m-0 d-flex justify-content-center align-items-center">
              <img src="./imagens/teste.jpeg" class="img-fluid" style="width:100%;height: 250px;">
          </div>
        </div>
        <div class="row w-100 p-0 m-0 produto">
          <div class="col-7 p-0  d-flex justify-content-start align-items-start">
            <span class="text-center" style="background-color: #550389;color: #efefef;margin-top: -25px;font-size: 18px;padding-top: 10px; font-weight: 400">
              <strong>${oferta.tipo}</strong> 
            </span>
          </div>
          <div class="col-5 p-0 m-0 d-flex justify-content-end align-items-center" style="margin-top:3px;">
              <p class="p-0 m-0" style="color: #747474;font-size:0.9rem;">
                  ${oferta.estado}
              <img src="./imagens/flagofBrazil_6577.png" class="img-fluid" style="width: 20px;height: 17px;margin-right:10px;">
              </p>
          </div>
        </div>
        <div class="row w-100" style="margin-top: 18px;">
          <p class="h6">Expira em</p>
        </div>
        <div class="row w-100 d-flex justify-content-center align-items-center">
          <div class="col-3 text-center d-flex justify-content-center align-items-center" style="background-color: #6EC1E4;">
            <div>
              <p class="p-0 m-0" id="dia" style="margin-right: 5px;color: #efefef;">00</p>
              <p class="p-0 m-0" id="textoDias" style="margin-right: 5px;font-size: 15px;color: #efefef;">Dias</p>
            </div>
           </div>
           <div class="col-3 text-center d-flex justify-content-center align-items-center" style="background-color: #6EC1E4;">
            <div>
              <p class="p-0 m-0" id="horas" style="margin-right: 5px;color: #efefef;">00</p>
              <p class="p-0 m-0" id="textoHoras" style="margin-right: 5px;font-size: 15px;color: #efefef;">Horas</p>
            </div>
           </div>
           <div class="col-3 text-center d-flex justify-content-center align-items-center" style="background-color: #6EC1E4;">
            <div>
              <p class="p-0 m-0" id="minutos" style="margin-right: 5px;color: #efefef;">00</p>
              <p class="p-0 m-0" id="textoMinutos" style="margin-right: 5px;font-size: 15px;color: #efefef;">Minutos</p>
            </div>
           </div>
           <div class="col-3 text-center d-flex justify-content-center align-items-center" style="background-color: #6EC1E4;">
            <div>
              <p class="p-0 m-0" id="segundos" style="margin-right: 5px;color: #efefef;">00</p>
              <p class="p-0 m-0" id="textoSegundos" style="margin-right: 5px;font-size: 15px;color: #efefef;">Segundos</p>
            </div>
           </div>
           
        </div>
        <div class="row p-0 m-0 w-100" style="margin-top:15px!important;">
          <div class="col p-0 m-0">
              <p class="text-sm" style="color: #747474;font-size: 1rem;font-weight: 700;margin-left:10px;">
                ${oferta.titulo}
              </p>
          </div>
        </div>
        <div class="row p-0 m-0 w-100" style="margin-top:11px!important;">
          <div class="col p-0 m-0">
              <p class="text-sm" style="color: #747474;font-size: 1rem;margin-left:10px;">
                ${oferta.descricao}
              </p>
          </div>
        </div>
        <div class="row p-0 m-0 w-100 text-center" style="margin-top:25px!important;">
          <div class="col">
              <p class="text-sm p-0 m-0 h1" style="color: #747474;font-size: 2rem;">
                RT$ 450,00
              </p>
          </div>
        </div>
        <div class="row w-100" style="margin-top:20px;margin-bottom:20px;">
          <div class="col m-0 p-0 d-flex flex-row justify-content-center align-items-center">
              <a type="button" href="/agencias/matriz/ofertas/info/" class="btn text-white fw-bold" style="width: 278px;height: 40px;line-height: 0.1;background-color: #FF6600;border-radius: 5px;padding: 10px 0px 10px 0px;font-size: 15px;">Ver Mais</a>
          </div>
        </div>
      </div>
        `;
        container.appendChild(newComponent);
      }
    </script>
    <!-- Script para carregar os cards iniciais quando a página carregar -->
    <script>
      function carregarCardsIniciais() {
        const apiUrl = `${window.apiBaseUrl}/ofertas`;

        fetch(apiUrl)
          .then((response) => response.json())
          .then((data) => {
            const container = document.querySelector(".cards .row");
            container.innerHTML = ""; // Remove os cards existentes do container

            if (data.hasOwnProperty("message")) {
              const h1 = document.createElement("h5");
              h1.textContent = "Sem ofertas cadastradas";
              container.appendChild(h1);
            } else {
              data.ofertas.forEach((oferta) => {
                adicionarCard(oferta); // Usa a função para adicionar o card
              });
            }
          })
          .catch((error) =>
            console.error("Erro ao obter os dados da API:", error)
          );
      }

      // Chama a função para carregar os cards iniciais quando a página carregar
      carregarCardsIniciais();
    </script>
    <!-- Script para filtrar e substituir os cards -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const btnLocalizar = document.getElementById("btnLocalizar");

        btnLocalizar.addEventListener("click", function () {
          const agencia = document.getElementById("selectAgencia").value;
          const titulo = document.getElementById("inputTitulo").value;
          const cidade = document.getElementById("inputCidade").value;
          const categoria = document.getElementById("selectCategoria").value;
          const tipo = document.getElementById("selectTipo").value;

          const dadosFiltro = {
            agencia: agencia,
            titulo: titulo,
            cidade: cidade,
            categoria: categoria,
            tipo: tipo,
          };
          const apiUrl = `${window.apiBaseUrl}/ofertas/filtro`;

          fetch(apiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(dadosFiltro),
          })
            .then((response) => response.json())
            .then((resultado) => {
              console.log(resultado);
              const container = document.querySelector(".cards .row");
              container.innerHTML = ""; // Remove os cards existentes do container

              if (resultado.hasOwnProperty("message")) {
                const h1 = document.createElement("h3");
                h1.textContent = "Sem ofertas encontradas";
                container.appendChild(h1);
              } else {
                resultado.forEach((oferta) => {
                  adicionarCard(oferta); // Usa a função para adicionar o card filtrado
                });
              }
            })
            .catch((error) => {
              console.error("Erro ao enviar requisição:", error);
            });
        });
      });
    </script>
    <!-- Script Contador Regressivo-->
    <script>
      // Obtenha o horário do servidor (substitua isso pelo horário real)
      // Isso pode ser obtido usando uma linguagem de script no lado do servidor ou uma API
      const horarioServidor = new Date("2023-08-31T10:46:00"); // Substitua pelo horário real

      function atualizarContador() {
        const agora = new Date();
        const diferencaTempo = horarioServidor - agora;

        if (diferencaTempo <= 0) {
          // O contador chegou ao fim
          document.getElementById("contador").innerHTML =
            "O contador chegou ao fim!";
          return;
        }

        const dias = Math.floor(diferencaTempo / (1000 * 60 * 60 * 24));
        const textoDias = document.getElementById("textoDias");
        if (dias <= 1) {
          textoDias.textContent = "Dia";
        } else {
          textoDias.textContent = "Dias";
        }
        const horas = Math.floor(
          (diferencaTempo % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );
        document.getElementById("horas").textContent = horas
          .toString()
          .padStart(2, "0");
        const textoHoras = document.getElementById("textoHoras");
        if (horas <= 1) {
          textoHoras.textContent = "Hora";
        } else {
          textoHoras.textContent = "Horas";
        }
        const minutos = Math.floor(
          (diferencaTempo % (1000 * 60 * 60)) / (1000 * 60)
        );
        document.getElementById("minutos").textContent = minutos
          .toString()
          .padStart(2, "0");
        const textoMinutos = document.getElementById("textoMinutos");
        if (minutos <= 1) {
          textoMinutos.textContent = "Minuto";
        } else {
          textoMinutos.textContent = "Minutos";
        }

        const segundos = Math.floor((diferencaTempo % (1000 * 60)) / 1000);
        document.getElementById("segundos").textContent = segundos
          .toString()
          .padStart(2, "0");
        const textoSegundos = document.getElementById("textoSegundos");
        if (segundos <= 1) {
          textoSegundos.textContent = "Segundo";
        } else {
          textoSegundos.textContent = "Segundos";
        }

        //const contadorString = `${dias}d ${horas}h ${minutos}min ${segundos}s`;
        //document.getElementById('contador').innerHTML = contadorString;
        // Atualizar os campos de dia, horas, minutos e segundos
        document.getElementById("dia").textContent = dias
          .toString()
          .padStart(2, "0");
        document.getElementById("horas").textContent = horas
          .toString()
          .padStart(2, "0");
        document.getElementById("minutos").textContent = minutos
          .toString()
          .padStart(2, "0");
        document.getElementById("segundos").textContent = segundos
          .toString()
          .padStart(2, "0");
      }

      // Atualizar o contador a cada segundo
      setInterval(atualizarContador, 1000);

      // Atualização inicial
      atualizarContador();
    </script>
  </body>
</html>
