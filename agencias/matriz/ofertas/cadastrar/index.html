<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="stylesheet" href="/assets/css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" href="/assets/css/custom.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
      integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>RedeTrade</title>
    <meta name="author" content="Lucas Santana" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"
      integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div class="wrapper">
      <!-- Sidebar  -->
      <side-bar></side-bar>

      <!-- Page Content  -->
      <div id="content">
        <!-- Navbar -->
        <nav-bar></nav-bar>
        <div class="container py-2">
          <div class="container-simple">
            <p class="text-muted font-weight-bold">Nova Oferta</p>
          </div>

          <div class="container p-4 bg-white rounded shadow">
            <div class="row">
              <div class="col-md-4">
                <img
                  src="/assets/img/default_img.png"
                  class="rounded float-left img-fluid pb-3"
                  alt="..."
                  id="imagem-selecionada"
                />
                <div class="custom-file">
                  <input
                    type="file"
                    class="custom-file-input bg-purple"
                    id="img_path"
                    name="img_path"
                  />
                  <label class="custom-file-label d-hide" for="img_path"
                    >Selecionar</label
                  >
                </div>
              </div>
              <div class="col-md-8">
                <div class="row">
                  <div class="col-md-3">
                    <label>Título</label>
                    <input type="text" class="form-control" id="titulo" />
                  </div>
                  <div class="col-md-3">
                    <label>Tipo</label>
                    <select class="form-control" id="tipo">
                      <option value="">Selecionar</option>
                      <option value="Produto">Produto</option>
                      <option value="Serviço">Serviço</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label>Status</label>
                    <select class="form-control" id="status">
                      <option value="">Selecionar</option>
                      <option value="1">Disponível</option>
                      <option value="0">Indisponível</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label>Categoria</label>
                    <select class="form-control" id="categoria">
                      <option value="">Selecionar</option>
                    </select>
                  </div>
                  <div class="col-md-12 pt-3">
                    <label>Descrição</label>
                    <textarea
                      class="form-control"
                      rows="9"
                      id="descricao"
                    ></textarea>
                  </div>
                </div>
              </div>
            </div>
            <div class="row pt-4">
              <div class="col-md-4">
                <label>Quantidade</label>
                <input type="number" class="form-control" id="quantidade" />
              </div>
              <div class="col-md-4">
                <label>Valor</label>
                <input type="number" class="form-control" id="valor" />
              </div>
              <div class="col-md-4">
                <label>Limite de Compra</label>
                <input
                  type="number"
                  class="form-control"
                  id="limite_de_compra"
                />
              </div>
              <div class="w-100 pt-2"></div>
              <div class="col-md-4">
                <label>Vencimento</label>
                <input type="date" class="form-control" id="vencimento" />
              </div>
              <div class="col-md-4">
                <label>Cidade</label>
                <input type="text" class="form-control" id="cidade" />
              </div>
              <div class="col-md-4">
                <label>Retirada</label>
                <select class="form-control" id="retirada">
                  <option value="">Selecionar</option>
                  <option value="Local">Local</option>
                  <option value="Entrega">Entrega</option>
                </select>
              </div>
              <div class="w-100 pt-2"></div>
              <div class="col-md-12">
                <label>Observações</label>
                <textarea
                  class="form-control"
                  rows="9"
                  id="observacoes"
                ></textarea>
              </div>
              <div class="w-100"></div>
              <div class="col-4 offset-8 text-right pt-4">
                <button
                  type="button"
                  class="btn btn-purple btm-sm btn-cadastrar"
                >
                  Salvar
                </button>
                <button type="button" class="btn btn-orange btm-sm">
                  Cancelar
                </button>
              </div>
            </div>
          </div>
        </div>
        <footer-bar></footer-bar>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.js"
      integrity="sha256-DrT5NfxfbHvMHux31Lkhxg42LY6of8TaYyK50jnxRnM="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script src="/assets/js/bootstrap.js"></script>
    <script src="/assets/js/main.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <!-- <script src="/__/firebase/7.21.0/firebase-app.js"></script> -->

    <!-- Import Components -->
    <script src="/components/navbar.js"></script>
    <script src="/components/sidebar2.js"></script>
    <script src="/components/footer.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <!-- <script src="/__/firebase/7.21.0/firebase-analytics.js"></script> -->

    <!-- Initialize Firebase -->
    <!-- <script src="/__/firebase/init.js"></script> -->
    <script src="/assets/js/config.js"></script>

    <!-- Script para carregar categorias -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Monta a URL da requisição GET com o parâmetro idAgencia incluindo o usuarioId
        const apiUrl = `${window.apiBaseUrl}/categorias/`;

        fetch(apiUrl)
          .then((response) => response.json())
          .then((data) => {
            // Processa os dados JSON recebidos

            data.forEach((categoria) => {
              // Cria uma linha na tabela para cada transação
              //console.log('Categoria', categoria);
              // Obtém a referência para o elemento <select>
              const categoriaSelect = document.getElementById("categoria");
              // Cria um elemento de opção
              const optionCategoria = document.createElement("option");
              // Define o texto da opção como o nome do plano
              optionCategoria.textContent = categoria.nome;
              // Define o valor da opção como o ID do plano
              optionCategoria.value = categoria.nome;
              // Adiciona a opção ao elemento <select>
              categoriaSelect.appendChild(optionCategoria);
            });
          })
          .catch((error) => console.error("Erro:", error));
      });
    </script>
    <!-- Script para Cadastrar Oferta -->
    <script>
      // Obtém o elemento do botão pelo seletor de classe
      const btnCadastrar = document.querySelector(".btn-cadastrar");

      // Adiciona um evento de clique ao botão
      btnCadastrar.addEventListener("click", () => {
        // Obtém os valores dos campos de entrada
        const titulo = document.querySelector("#titulo").value;
        const tipo = document.querySelector("#tipo").value;
        const status = document.querySelector("#status").value;
        const categoria = document.querySelector("#categoria").value;
        const obs = document.querySelector("#descricao").value;
        const quantidade = document.querySelector("#quantidade").value;
        const valor = document.querySelector("#valor").value;
        const limite_de_compra =
          document.querySelector("#limite_de_compra").value;
        const vencimento = document.querySelector("#vencimento").value;
        const cidade = document.querySelector("#cidade").value;
        const retirada = document.querySelector("#retirada").value;
        var cookies = document.cookie.split(";");
        var idUsuario = null;

        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.indexOf("usuarioId=") === 0) {
            idUsuario = cookie.substring("usuarioId=".length, cookie.length);
            break;
          }
        }

        // Crie um objeto FormData para enviar os dados do formulário
        const formData = new FormData();
        formData.append("titulo", titulo);
        formData.append("tipo", tipo);
        formData.append("status", status);
        formData.append("categoria", categoria);
        formData.append("quantidade", quantidade);
        formData.append("valor", valor);
        formData.append("limite_de_compra", limite_de_compra);
        formData.append("vencimento", vencimento);
        formData.append("cidade", cidade);
        formData.append("retirada", retirada);
        formData.append("obs", obs);
        formData.append("idUsuario", idUsuario);

        // Obtenha o arquivo da imagem
        const fileInput = document.getElementById("img_path");
        const img_path = fileInput.files[0];
        formData.append("img_path", img_path);

        // Configurações da requisição fetch
        const apiUrl = `${window.apiBaseUrl}/ofertas`;
        fetch(apiUrl, {
          method: "POST", // Ou o método HTTP correto (GET, POST, etc.)
          body: formData,
        })
          .then((response) => {
            // Manipula a resposta da requisição
            if (response.ok) {
              // A requisição foi bem-sucedida
              //console.log('Requisição enviada com sucesso!');
              showAlertCadastro("Oferta cadastrada  com sucesso!", "success");
              setTimeout(() => {
                //$('#myModal').modal('hide');
                location.reload();
              }, 4000);
            } else {
              // A requisição falhou
              console.log("Erro na requisição.");
            }
          })
          .catch((error) => {
            // Captura erros de rede ou outras exceções
            console.log("Erro na requisição:", error);
          });
      });
    </script>
    <!-- Script de Alerts-->
    <script>
      function showAlert(message, type) {
        var alert = document.createElement("div");
        alert.classList.add("alert", "alert-" + type);
        alert.innerHTML = message;
        var container = document.querySelector(".container");
        container.insertBefore(alert, container.firstChild);
        setTimeout(function () {
          alert.remove();
        }, 3000);
      }

      function showAlertCadastro(message, type) {
        var alert = document.createElement("div");
        alert.classList.add("alert", "alert-" + type);
        alert.innerHTML = message;
        var container = document.querySelector(".container");
        container.insertBefore(alert, container.firstChild);
        setTimeout(function () {
          alert.remove();
        }, 3000);
      }
    </script>
    <!-- Carregar Imagem -->
    <script>
      // Adiciona um evento de escuta ao input file
      document
        .getElementById("img_path")
        .addEventListener("change", function (event) {
          // Obtém o elemento da imagem selecionada
          var imgElement = document.getElementById("imagem-selecionada");

          // Verifica se o usuário selecionou um arquivo
          if (event.target.files.length > 0) {
            // Obtém o arquivo selecionado pelo usuário
            var file = event.target.files[0];

            // Cria um URL temporário para a imagem selecionada
            var imageURL = URL.createObjectURL(file);

            // Define o URL temporário como o atributo src da tag img
            imgElement.src = imageURL;
          } else {
            // Caso o usuário não tenha selecionado um arquivo, exibe a imagem padrão
            imgElement.src = "/assets/img/default_img.png";
          }
        });
    </script>
  </body>
</html>
